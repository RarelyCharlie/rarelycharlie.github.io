var remarks;n=0,showmessage=function(){var e=$("#content > ul > li").eq(n);if(!e.length){var t=$("#content");$("#content>ul");return t.append("<p>The chat has ended.</p>",remarks),remarks.length&&setTimeout(function(){remarks.show(),showbase()},2e3),void showbase()}var s=e.contents().get(0).nodeValue;if(""!=s){var a=Math.max(1200,2500*parseInt(s));s=s.replace(/^\d*/,""),t="L"==(t=s.charAt(0))?"listener":"M"==t?"member":"H"==t?"heart":"Q"==t?"quiz":"info",s=s.substr(1).trim();var o=$("li",e);"quiz"==t&&o.length&&(s='<p class="lede">'+s+'</p><p class="radios">',o.each(function(e,t){var a="q"+n+"r"+e,o=$(this).text(),i=parseInt(o);o=o.replace(/^\d*\s*/,""),s+='<label for="'+a+'"><input type="radio" name="q'+n+'" id="'+a+'" data-help="'+i+'">'+o+"</label>"}),s+="</p>"),"heart"==t&&(setTimeout(function(){$("#content p.listener").append('<i class="fa fa-heart like"></i>')},a/3),t="member"),"member"==t&&setTimeout(function(){$("#content").append('<p class="typing">The member is typing&hellip;</p>'),showbase()},a/2),setTimeout(function(){"listener"==t?slowtype(s):"member"==t?($(".typing").replaceWith('<p style="opacity: 0;" class="member">'+smilify(s)+"</p>"),showbase(),$("#content p:last-child").fadeTo(400,1,showmessage)):"info"==t?($("#content").append('<p class="'+t+'">'+s+"</p>"),showbase(),showmessage()):"quiz"==t&&($("#content").append(s),showbase())},a),showbase(),++n}},slowtype=function(e){if(showbase(),""!=e){var t=e.charAt(0),s=$("#msgtext");setTimeout(function(){s.text(s.text()+t),slowtype(e.substr(1))},40+40*Math.random())}else setTimeout(function(){$("#send").removeAttr("disabled")},400)},sendmessage=function(){showbase(),$(this).attr("disabled")||($("#content").append('<p class="listener">'+smilify($("#msgtext").text())+"</p>"),$("#send")[0].scrollIntoView(),$("#msgtext").text(""),$(this).attr("disabled",!0),showmessage())},radioclick=function(e){var t=e.target,s=t.getAttribute("data-help")%43;if($("#content p.hint").remove(),s&&$("#content").append('<p class="hint">'+(s<20?"Yes. ":"No. ")+cheat[s]+(s<20?"":" You lost a star.")+"</p>"),s<20)t.parentNode.className="chosen",t.parentNode.parentNode.className="chosen",$("#content input").prop("disabled",!0),slowtype(t.nextSibling.nodeValue);else{var n=$("#stars .fa-star");n.last().attr("class","fa fa-star-o"),1==n.length&&($("#content input").prop("disabled",!0),$("#content").append('<p class="info">You have no more stars. The member blocked you.</p>'))}showbase()},showbase=function(){$("#stars")[0].scrollIntoView()},smilify=function(e){var t="https://d37v7cqg82mgxu.cloudfront.net/img/emoticons/";return e.replace(/:\)/g,'<img src="'+t+'smile.png" alt="Smile" title="Smile" />').replace(/<3/g,'<img src="'+t+'heart.png" alt="Heart" title="Heart" />')},document.addEventListener("DOMContentLoaded",function(){$("#content").show(),"index"!=document.body.className&&($("#send").on("click",sendmessage),$("#content").on("change",radioclick),(remarks=$("#content>ul").nextAll()).length&&remarks.first().prepend("<strong>Reflection: </strong>"),remarks.hide(),$("ul ul").length&&$("#stars i").show(),showmessage())});
